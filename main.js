var w=r=>{throw TypeError(r)};var v=(r,e,t)=>e.has(r)||w("Cannot "+t);var i=(r,e,t)=>(v(r,e,"read from private field"),t?t.call(r):e.get(r)),y=(r,e,t)=>e.has(r)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),L=(r,e,t,n)=>(v(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);import{a as z,S as N,i as C}from"./assets/vendor-B9mnahA8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var c,u;class j{constructor(e={}){y(this,c,{});y(this,u,{});L(this,c,{...e})}getState(e){return i(this,c)[e]}setState(e,t){i(this,c)[e]!==t&&(i(this,c)[e]=t,this.notify(e))}subscribe(e,t){i(this,u)[e]||(i(this,u)[e]=[]),i(this,u)[e].push(t),t(i(this,c)[e],i(this,c))}notify(e){if(i(this,u)[e])for(const t of i(this,u)[e])t(i(this,c)[e],i(this,c))}}c=new WeakMap,u=new WeakMap;const A="https://us-central1-dev-test-448809.cloudfunctions.net/pixabayProxy/";async function P(r,e="1"){const t=new URLSearchParams({q:encodeURIComponent(r),image_type:"photo",orientation:"horizontal",safesearch:"true",per_page:"15",page:e}),n=`${A}?${t}`;return(await z.get(n)).data}function K(r){const e=document.querySelector(".loader");return r?e==null||e.classList.remove("hidden"):e==null||e.classList.add("hidden"),e}function M(r,e,t){console.log("renderButtonMore called",{images:r,loading:e});const n=document.querySelector(".button-load-more");e||r.length===0||t===-1?n==null||n.classList.add("hidden"):n==null||n.classList.remove("hidden")}function O(r,e){const t=document.querySelector(".gallery");e&&!t.innerHTML?t==null||t.classList.add("hidden"):t==null||t.classList.remove("hidden");const n=Array.from(t.querySelectorAll("a.gallery-link")).map(l=>l.dataset.id),s=r.map(l=>l.id);if(n.join("|")===s.join("|"))return;const o=document.querySelector("#gallery-item-template"),d=document.createDocumentFragment();if(r.forEach(({id:l,webformatURL:p,largeImageURL:S,tags:b,likes:$,comments:D,views:T,downloads:B})=>{const h=o.content.cloneNode(!0),q=h.querySelector("a.gallery-link"),m=h.querySelector("img.gallery-image");q.dataset.id=l,q.href=S,m.src=p,m.alt=b,m.title=b,m.dataset.source=S;const g=h.querySelector(".gallery-item-meta"),F=g.querySelector(".meta-likes-value"),I=g.querySelector(".meta-views-value"),V=g.querySelector(".meta-comments-value"),_=g.querySelector(".meta-downloads-value");F.textContent=`${$||0}`,I.textContent=`${T||0}`,V.textContent=`${D||0}`,_.textContent=`${B||0}`,d.appendChild(h)}),t.innerHTML="",t.appendChild(d),t._instance)t._instance.refresh();else{const l=new N(".gallery a",{captions:!0,captionDelay:250,captionPosition:"bottom"});l.on("show.simplelightbox",function(...p){}),l.on("error.simplelightbox",function(...p){}),t._instance=l}}function U(r){setTimeout(()=>{const e=document.querySelector(`a[data-id="${r}"]`);if(e){const t=document.createElement("div");t.style.position="absolute",t.style.top="-20px",e.insertBefore(t,e.firstChild),t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}else console.warn(`Tile with id ${r} not found`)},200)}C.settings({position:"topRight",timeout:2e3,close:!1,progressBar:!1,transitionIn:"bounceInUp",transitionOut:"fadeOutDown"});const x={success:"#4caf50",error:"#f44336"},H={success:"fas fa-check",error:"fas fa-ban"};function f(r,e="success"){C[e]({message:r,icon:H[e]||"fas fa-info",iconColor:x[e]||"#ddd",progressBarColor:x[e]||"#ddd"})}const a=new j({loading:!1,images:[],page:1,search:""});a.subscribe("loading",K);a.subscribe("loading",(r,{images:e})=>O(e,r));a.subscribe("images",(r,{loading:e})=>O(r,e));a.subscribe("loading",(r,{images:e,page:t})=>M(e,r,t));a.subscribe("images",(r,{loading:e,page:t})=>M(r,e,t));(function(){const e=document.querySelector(".form");e==null||e.addEventListener("submit",async t=>{t.preventDefault();const n=new FormData(e),s=Object.fromEntries(n.entries());if(!s.search){f("Please enter a search query","error");return}if(s.search===a.getState("search")){f(`You already searched for "${s.search}"`,"error");return}a.setState("images",[]),a.setState("search",s.search),a.setState("page",1),a.setState("loading",!0);try{const o=await P(s.search,"1");o.hits.length===0?f("We're sorry, but you've reached the end of search results.","error"):a.setState("images",o.hits)}catch(o){console.error("Error fetching images:",o),f("Error fetching images","error")}a.setState("loading",!1)})})();(function(){const e=document.querySelector(".button-load-more");e==null||e.addEventListener("click",async()=>{var s;const t=a.getState("search");a.setState("loading",!0);const n=a.getState("page")+1;a.setState("page",n);try{const o=await P(t,n);o.hits.length===0?(f("We're sorry, but you've reached the end of search results.","error"),a.setState("page",-1)):(a.setState("images",[...a.getState("images"),...o.hits]),U((s=o.hits[0])==null?void 0:s.id))}catch(o){console.error("Error fetching images:",o),f("Error fetching images","error")}a.setState("loading",!1)})})();
